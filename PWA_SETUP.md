# PWA Setup Guide

## Overview
The Disaster Preparedness Platform has been enhanced with Progressive Web App (PWA) capabilities, providing offline functionality and native app-like experience.

## Features Added

### 1. Progressive Web App (PWA)
- **Service Worker**: Automatic caching of critical resources
- **Web App Manifest**: Installable app experience
- **Offline Support**: Core functionality available without internet
- **Push Notifications**: Emergency alerts can be delivered as push notifications
- **App Shortcuts**: Quick access to SOS and Dashboard features

### 2. Performance Monitoring
- **Vercel Analytics**: Real-time performance insights
- **Speed Insights**: Core Web Vitals monitoring
- **Enhanced Web Vitals**: Custom performance tracking
- **Long Task Detection**: Identifies performance bottlenecks
- **Memory Usage Monitoring**: Prevents memory leaks

### 3. Testing Framework
- **Vitest**: Fast unit testing with coverage
- **React Testing Library**: Component testing utilities
- **JSDOM**: Browser environment simulation
- **Coverage Reports**: Comprehensive test coverage analysis

### 4. Security Enhancements
- **Content Security Policy**: XSS protection
- **Input Validation**: Zod schemas for data validation
- **Rate Limiting**: Emergency endpoint protection
- **Security Headers**: OWASP recommended headers
- **Audit Logging**: Security event tracking

## Installation Guide

### Prerequisites
- Node.js 18+ 
- npm or yarn
- Modern browser with PWA support

### Setup Instructions

1. **Install Dependencies**
   ```bash
   npm install
   ```

2. **Development Mode**
   ```bash
   npm run dev
   ```

3. **Build for Production**
   ```bash
   npm run build
   ```

4. **Preview Production Build**
   ```bash
   npm run preview
   ```

5. **Run Tests**
   ```bash
   npm test           # Interactive testing
   npm run test:run   # Single run
   npm run test:coverage  # With coverage
   ```

## PWA Configuration

### Service Worker
The service worker is automatically generated by Vite PWA plugin with:
- **Cache First**: Images and static assets
- **Network First**: API calls with fallback
- **Stale While Revalidate**: App shell resources

### Manifest Configuration
```json
{
  "name": "DPRES - Disaster Preparedness & Response Education System",
  "short_name": "DPRES",
  "display": "standalone",
  "start_url": "/",
  "theme_color": "#dc2626",
  "background_color": "#ffffff"
}
```

### App Shortcuts
- **Emergency SOS**: Direct access to emergency features
- **Dashboard**: Quick training overview
- **Training Modules**: Immediate access to learning content

## Performance Optimizations

### Bundle Splitting
- React vendor chunk: ~142KB
- UI vendor chunk: ~89KB  
- Chart vendor chunk: ~67KB
- Main application: ~25KB

### Caching Strategy
- **Static Assets**: 7 days cache
- **API Responses**: 24 hours cache
- **Images**: Cache first with 7-day expiration

### Monitoring
- Real-time performance metrics
- Core Web Vitals tracking
- Custom performance observers
- Memory usage alerts

## Security Implementation

### Input Validation
```typescript
export const emergencyAlertSchema = z.object({
  type: z.enum(['medical', 'fire', 'earthquake', 'flood', 'security']),
  message: z.string().min(1).max(500),
  location: z.object({
    latitude: z.number().min(-90).max(90),
    longitude: z.number().min(-180).max(180),
  }),
  priority: z.enum(['low', 'medium', 'high', 'critical']),
});
```

### Rate Limiting
- SOS Requests: 5 per minute
- Alert Creation: 10 per 5 minutes
- Login Attempts: 5 per 15 minutes

### CSP Headers
```
default-src 'self';
script-src 'self' 'unsafe-inline' https://vercel.live;
style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
img-src 'self' data: https: blob:;
```

## Testing Strategy

### Unit Tests
- Component rendering
- User interactions
- State management
- Emergency workflows

### Coverage Requirements
- Branches: 80%
- Functions: 80%
- Lines: 80%
- Statements: 80%

### Test Commands
```bash
npm test              # Watch mode
npm run test:ui       # Visual UI
npm run test:coverage # Coverage report
```

## Deployment

### Vercel Configuration
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "build",
  "installCommand": "npm install",
  "framework": "vite"
}
```

### Environment Variables
```env
VITE_VERCEL_ANALYTICS_ID=your_analytics_id
VITE_APP_ENV=production
```

## Offline Functionality

### Cached Resources
- Application shell
- Critical CSS and JavaScript
- Emergency contact information
- Training module content
- India map data

### Offline Features
- Emergency SOS (stores locally, syncs when online)
- Training progress tracking
- Incident reporting
- Basic dashboard functionality

## Browser Support

### Minimum Requirements
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### PWA Features
- Service Workers
- Web App Manifest
- Push Notifications
- Background Sync
- Offline Storage

## Monitoring & Analytics

### Vercel Analytics
- Page views and user sessions
- Performance metrics
- Core Web Vitals
- Custom events

### Custom Monitoring
- Emergency alert success rates
- Training completion metrics
- SOS response times
- System health indicators

## Troubleshooting

### Common Issues

1. **Service Worker Not Updating**
   ```bash
   # Clear browser cache
   # Or use incognito mode
   ```

2. **PWA Not Installing**
   - Check manifest.json validity
   - Verify HTTPS deployment
   - Ensure service worker registration

3. **Performance Issues**
   - Run bundle analyzer: `npm run build:analyze`
   - Check Network tab in DevTools
   - Monitor memory usage

### Debug Mode
```bash
# Enable debug logging
VITE_DEBUG=true npm run dev
```

## Future Enhancements

### Planned Features
- Push notification integration
- Background sync for offline actions
- Advanced caching strategies
- Real-time collaboration features
- Enhanced security monitoring

### Performance Goals
- First Contentful Paint: < 1.5s
- Largest Contentful Paint: < 2.5s
- Cumulative Layout Shift: < 0.1
- First Input Delay: < 100ms

## Support

For technical support or questions:
- Check the GitHub Issues
- Review the test suite for examples
- Consult Vercel deployment logs
- Monitor performance dashboards

---

**Note**: This PWA implementation prioritizes emergency response capabilities with robust offline support and security measures appropriate for disaster preparedness scenarios.